"text", "numeric", "text"
)) %>%
setNames(v1_names_5ws) %>%
mutate(source = file_list_v1[i]) %>%
# Doing this here, but you can always move this to the end
# But this is the assumption that these lists are correct
mutate(
names_numbers_schools = case_when(
names_numbers_schools == "All the Juniour Secondary Schools (JSS) in Kalobeyei Settlement" ~
"Kalobeyei Settlement, Friends, Joy, Morningstar, Future and Bright Junior Secondary Secondary schools.",
names_numbers_schools == "All the main Secondary Schools in Kalobeyei Settlement" ~
"Kalobeyei Settlement, Friends, Joy, Morningstar, Future and Bright Junior Secondary Secondary schools.",
TRUE ~ names_numbers_schools)) %>%
mutate(
number_schools = case_when(
activity == "Provision of school meals to learners in the 8 primary schools and 7 pre-primary schools in Kalobeyei Settlement." ~ 15,
names_numbers_schools == "22 refugee schools and 11 host community schools" ~ 33,
comments == "37 schools supported with 115 handwashing kits" ~ 37,
str_detect(names_numbers_schools, "\n") ~ str_count(names_numbers_schools, "\n") + 1,
str_detect(names_numbers_schools, "\\,") ~ str_count(names_numbers_schools, "\\,|and|&") + 1,
str_detect(names_numbers_schools, "and") ~ str_count(names_numbers_schools, "and") + 1,
str_detect(names_numbers_schools, "\\;") ~ str_count(names_numbers_schools, "\\;") + 1,
!is.na(names_numbers_schools) ~ parse_number(names_numbers_schools),
TRUE ~ NA_integer_),
number_schools = ifelse(!is.na(names_numbers_schools) & is.na(number_schools), 1, number_schools)
) %>%
replace_with_na(replace = list(names_numbers_schools = "N/A")) %>%
standard_cleaning() %>%
filter(!is.na(month) & !is.na(lead_organisation) & !is.na(indicator)) %>%
mutate(source = str_remove(source,
"C:/Users/seanywng/Documents/R/eie_wg_5ws/data/5Ws_2023/")) %>%
filter(!is.na(indicator)) %>%
mutate(implementing_partner = ifelse(is.na(implementing_partner), lead_organisation, implementing_partner))
}
read_5ws_v2 <- function(file) {
read_excel(file,
sheet = "5W_Data_Entry",
skip = 2,
col_types = c(
"text", "text", "text", "text", "text", "text",
"text", "text", "text", "text", "text", "text",
"date", "date",
"text",
"numeric", "numeric", "numeric", "numeric",
"text", "numeric", "text"
)) %>%
setNames(v2_names_5ws) %>%
mutate(source = file_list_v2[i]) %>%
replace_with_na(replace = list(names_numbers_schools = "N/A")) %>%
filter(!is.na(month) & !is.na(lead_organisation) & !is.na(indicator)) %>%
standard_cleaning() %>%
mutate(source = str_remove(source,
"C:/Users/seanywng/Documents/R/eie_wg_5ws/data/5Ws_2023_v2/")) %>%
filter(!is.na(indicator)) %>%
mutate(implementing_partner = ifelse(is.na(implementing_partner), lead_organisation, implementing_partner))
}
## Path to 4Ws
# This is the folder where the 4Ws from the current round are stored
path_5ws <- "C:/Users/seanywng/Documents/R/eie_wg_5ws/data/5Ws_2023"
# Change the folder to the correct one
# The files will be read from here
file_list_v1 <- list.files(path = path_5ws,
recursive = TRUE,
pattern = "\\.xlsx$",
full.names = TRUE)
# Filtering out open? files? Not sure
file_list_v1 <- file_list_v1[!str_detect(file_list_v1, "\\~")]
# Ok, got the for loop to work
# Initialise empty data frame
# Apparently, to
eie_a <- data.frame()
# Loop
for (i in 1:length(file_list_v1)) {
eie_a_i <- read_5ws_v1(file_list_v1[i])
eie_a <- rbind(eie_a, eie_a_i)
}
path_5ws_v2 <- "C:/Users/seanywng/Documents/R/eie_wg_5ws/data/5Ws_2023_v2"
# Last argument filters out any open or temp excel files
file_list_v2 <- list.files(path = path_5ws_v2,
recursive = TRUE,
pattern = "\\.xlsx$",
full.names = TRUE)
file_list_v2 <- file_list_v2[!str_detect(file_list_v2, "\\~")]
eie_b <- data.frame()
for (i in 1:length(file_list_v2)) {
eie_b_i <- read_5ws_v2(file_list_v2[i])
eie_b <- rbind(eie_b, eie_b_i)
}
eie <- rbind(eie_a %>%
select(-names_numbers_schools), eie_b) %>%
mutate(number_schools = as.numeric(number_schools))
eie %>%
# This checks the sum of boys, girls, men and women with the total reached
mutate(total_reached_check = rowSums(.[15:18], na.rm = TRUE)) %>%
filter(total_reached_check != total_reached)
eie %>%
# This checks that all counties have matched pcodes
filter(is.na(adm1_pcode)) %>%
distinct(county)
# Check for missing implementing partners
eie %>% filter(is.na(implementing_partner))
eie %>% filter(str_detect(indicator, "1") & men > 0)
eie %>% count(indicator)
partners_raw  <- read_csv("./data/partner_names_raw.csv") %>%
clean_names() %>%
distinct(partner_type, agency_name, acronym) %>%
mutate_at(vars(agency_name, acronym), ~ str_trim(str_squish(.))) %>%
filter(agency_name %out% c("National Council for Nomadic Education Kenya",
"National Council of Nomadic Education in Kenya",
"MINISTRY OF EDUCATION",
"ChildFund",
"Childfund",
"CISP Kenya",
"Comitato Internazionale per lo Sviluppo dei Popoli (International Committee for the Development of Peoples) - CISP Kenya.",
"Jesuits Refugee Service",
"Save the Children International",
"AVSI FAOUNDATION",
"ChildFund kenya",
"Kenya RedCross Society",
"FINN CHURCH AID",
"Concern worldwide",
"Dignitas Limited",
"AVSI FOUDNATION")) %>%
mutate(agency_name = recode(agency_name,
"Action for sustainable change" = "Action for Sustainable Change",
"AVSI FOUNDATION" = "AVSI Foundation",
"QATAR CHARITY" = "Qatar Charity",
"Life Skills Promoters" = "Lifeskills Promoters",
"Girl Child Network" = "The Girl Child Network",
"WE WORLD" = "We World",
"KENYA NATIONAL COMMISSION FOR UNESCO" = "UNESCO",
"Kenya National Commission for UNESCO" = "UNESCO")) %>%
mutate(acronym = case_when(agency_name == "Christian Blind Mission"~ "CBM",
agency_name == "Concern Worldwide" ~ "CW",
agency_name == "Finn Church Aid" ~ "FCA",
agency_name == "Mondo" ~ "Mondo",
agency_name == "Plan International Kenya" ~ "PLAN",
agency_name == "Rotary International" ~ "RI",
agency_name == "World Vision Kenya" ~ "WVK",
agency_name == "FilmAid Kenya" ~ "FA",
agency_name == "ResQ247" ~ "ResQ",
agency_name == "LEGO Foundation" ~ "LEGO",
agency_name == "St Paul's university" ~ "SPU",
agency_name == "Dignitas" ~ "DIGN",
agency_name == "EducAid" ~ "EducAid",
agency_name == "Humanity & Inclusion" ~ "H&I",
agency_name == "Build Africa Kenya" ~ "BAK",
agency_name == "Edukans Kenya" ~ "Edukans",
agency_name == "Action for Sustainable Change" ~ "AFOSC",
agency_name == "Elimu Yetu Coalition" ~ "EYC",
agency_name == "CRESNET CBO" ~ "CRES",
agency_name == "MOE Wajir" ~ "MOE Wajir",
agency_name == "Qatar Charity" ~ "QATAR",
agency_name == "Education Management & Leadership" ~ "EML",
agency_name == "International Aid Services Kenya" ~ "IASK",
agency_name == "Worldreader" ~ "WR",
agency_name == "ChildFund Kenya" ~ "CF",
agency_name == "The Girl Child Network" ~ "GCN",
agency_name == "KENYA NATIONAL COMMISSION FOR UNESCO" ~ "UNESCO",
agency_name == "Kenya National Commission for UNESCO" ~ "UNESCO",
agency_name == "UNESCO" ~ "UNESCO",
TRUE ~ acronym)) %>%
distinct(partner_type, partner = agency_name, acronym) %>%
arrange(partner)
partner_list_counties <- eie %>%
mutate_at(vars(lead_organisation, implementing_partner), ~ str_trim(str_squish(.))) %>%
mutate(lead_organisation = ifelse(lead_organisation == implementing_partner,
NA_character_,
lead_organisation)) %>%
select(county, adm1_pcode, lead_organisation, implementing_partner) %>%
pivot_longer(cols = c(lead_organisation, implementing_partner),
names_to = "partner_type",
values_to = "partner") %>%
filter(!is.na(partner)) %>%
left_join(partners_raw %>%
select(partner, acronym),
by = "partner") %>%
mutate(acronym = case_when(partner == "Food for the Hungry" ~ "FHK",
partner == "Nawiri Children Development Program" ~ "NCDP",
partner == "Frontiers Community Development Program" ~ "FCDP",
partner == "Homa Bay County" ~ "HBC",
partner == "Special Olympics Kenya" ~ "SOK",
partner == "Servants of the Poor" ~ "SP",
partner == "Evangelizing Sisters of Mary" ~ "ESM",
partner == "IWS" ~ "IWS",
partner == "CDE Wajir" ~ "CDE Wajir",
partner == "Missionary Sisters of the Catechism" ~ "MCS",
partner == "ERIKs Development Partner" ~ "ERIKs",
partner == "SMB" ~ "SMB",
partner == "Mondi" ~ "MON",
partner == "Bartabwa" ~ "BART",
partner == "CDE Mandera" ~ "CDE Mandera",
partner == "Windle International Kenya" ~ "WIK",
partner == "The Girl Child Network" ~ "GCN",
partner == "Futebol da Forcaa" ~ "FUTE",
partner == "Ministry of Education" ~ "MOE",
partner == "UNICEF" ~ "UNICEF",
partner == "ChildFund Kenya" ~ "CF",
partner == "County Director of Education Wajir" ~ "CDE Wajir",
partner == "County Director of Education Mandera" ~ "CDE Mandera",
partner == "County Director of Education Marsabit" ~ "CDE Marsabit",
partner == "UNESCO" ~ "UNESCO",
partner == "MOE/TSC" ~ "MOE/TSC",
partner == "Women Education Researchers of Kenya" ~ "WERK",
partner == "Edukans" ~ "EDK",
partner == "KENYA NATIONAL COMMISSION FOR UNESCO" ~ "UNESCO",
TRUE ~ acronym)) %>%
mutate(partner = str_replace_all(partner, "CDE", "County Director of Education"),
partner = str_replace_all(partner, "Girl Child Network|The Girl Child Network",
"The Girl Child Network"),
acronym = ifelse(partner == "The Girl Child Network", "GCN", acronym))
partner_list_counties
partner_list_counties %>% distinct(partner)
partner_list_counties %>% distinct(partner) %>% arrange(partner)
partner_list_counties %>% distinct(partner) %>% arrange(partner) %>% write_csv("./data/partner_list_5ws.csv")
library(shiny); runApp('~/R/kenya_county_profiles_app/draft/app2.R')
runApp('~/R/kenya_county_profiles_app/draft/app2.R')
runApp('~/R/kenya_county_profiles_app/draft/app2.R')
runApp('~/R/kenya_county_profiles_app/draft/app2.R')
runApp('~/R/kenya_county_profiles_app/draft/app2.R')
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(janitor)
library(scales)
library(viridis)
library(patchwork)
library(DT)
library(here)
library(sf)
library(plotly)
library(flextable)
library(ggrepel)
library(anytime)
library(tidytext)
library(ggsflabel)
theme_set(theme_light())
# Installation of mdepriv package
# install package devtools if not yet installed
#   install.packages("devtools")
# install fast from GitHub without vignettes
#   devtools::install_github("a-benini/mdepriv", build_vignettes = FALSE
# Alternatively, follow the instructions here: https://a-benini.github.io/mdepriv/
# disabling scientific notation
options(scipen = 100)
`%out%` <- Negate(`%in%`)
# function for transposing df
transpose_df <- function(df) {
t_df <- data.table::transpose(df)
colnames(t_df) <- rownames(df)
rownames(t_df) <- colnames(df)
t_df <- t_df %>%
tibble::rownames_to_column(.data = .) %>%
tibble::as_tibble(.)
return(t_df)
}
# scaling functions
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
# mode function
mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
# Fixing dates
name_to_date <- function(x) {
lubridate::mdy(ifelse(x %in% c(month.name, month.abb), paste0(x, "/01/2023"), x))
}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(readxl)
eie <- read_csv("./data/eie_5ws.csv") %>%
filter(!is.na(indicator_short)) %>%
replace_na(list(boys = 0, girls = 0, men = 0, women = 0)) %>%
# Total reached of indicator 1 is only boys and girls
mutate(total_reached = case_when(str_detect(indicator, "1") ~ boys + girls,
str_detect(indicator, "5") ~ men + women,
str_detect(indicator, "6") ~ boys + girls,
TRUE ~ total_reached))
eie %>% filter(str_detect(indicator, "1")) %>% slice(1) %>% pull(indicator)
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0)
library(flextable)
library(readxl)
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE))
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(implementing_partner) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE))
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE))
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1")
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .8)
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .5)
eie %>%
filter(str_detect(indicator, "1")) %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .5)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .5)
eie %>% filter(str_detect(indicator, "2")) %>% slice(1) %>% pull(indicator)
eie %>% filter(str_detect(indicator, "3")) %>% slice(1) %>% pull(indicator)
eie %>% filter(str_detect(indicator, "4")) %>% slice(1) %>% pull(indicator)
eie %>%
filter(str_detect(indicator, "5") & activity_status == "Completed") %>%
filter(boys > 0 | girls > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Children reported under Indicator 5") %>%
set_table_properties(layout = "autofit", width = .5)
eie %>%
filter(str_detect(indicator, "5") & activity_status == "Completed") %>%
filter(boys > 0 | girls > 0) %>%
group_by(county) %>%
summarise(boys = sum(boys, na.rm = TRUE),
girls = sum(girls, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Children reported under Indicator 5") %>%
set_table_properties(layout = "autofit", width = .5)
eie %>%
filter(str_detect(indicator, "6") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .5)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(readxl)
library(flextable)
library(pander)
library(tinytex)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander()
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander() %>%
format(big.mark = ",")
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(format(big.mark = ","))
panderOptions(format(big.mark = ","))
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(readxl)
library(flextable)
library(pander)
library(tinytex)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(., format(big.mark = ","))
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(format(., big.mark = ","))
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row")
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(big.mark = ",")
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(big.mark = ",") %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .7)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
pander(big.mark = ",") %>%
set_caption("Adults reported under Indicator 1")
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(layout = "autofit", width = .7)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(width = .7)
eie %>%
filter(str_detect(indicator, "1") & activity_status == "Completed") %>%
filter(men > 0 | women > 0) %>%
group_by(county) %>%
summarise(men = sum(men, na.rm = TRUE),
women = sum(women, na.rm = TRUE)) %>%
janitor::adorn_totals("row") %>%
flextable() %>%
theme_zebra() %>%
set_caption("Adults reported under Indicator 1") %>%
set_table_properties(width = .9)
