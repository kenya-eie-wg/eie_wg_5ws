---
title: "Untitled"
output: html_document
date: '2023-06-27'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(janitor)
library(scales)
library(viridis)
library(patchwork)
library(DT)
library(here)
library(sf)
library(plotly)
library(flextable)
library(ggrepel)
library(anytime)
library(tidytext)

theme_set(theme_light())

# Installation of mdepriv package
# install package devtools if not yet installed
#   install.packages("devtools")

# install fast from GitHub without vignettes 
#   devtools::install_github("a-benini/mdepriv", build_vignettes = FALSE

# Alternatively, follow the instructions here: https://a-benini.github.io/mdepriv/

# disabling scientific notation
options(scipen = 100)

`%out%` <- Negate(`%in%`)

# function for transposing df
transpose_df <- function(df) {
  t_df <- data.table::transpose(df)
  colnames(t_df) <- rownames(df)
  rownames(t_df) <- colnames(df)
  t_df <- t_df %>%
    tibble::rownames_to_column(.data = .) %>%
    tibble::as_tibble(.)
  return(t_df)
}

# scaling functions 
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}

# mode function 
mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Fixing dates
name_to_date <- function(x) {
  lubridate::mdy(ifelse(x %in% c(month.name, month.abb), paste0(x, "/01/2023"), x))
}


```

```{r}

messy <- c("month", 
  "indicator1_all_total", 
  "indicator1_all_boys", 
  "indicator1_all_girls",
  "indicator1_host_community_total", 
  "indicator1_host_community_boys", 
  "indicator1_host_community_girls",
  "indicator1_idps_total", 
  "indicator1_idps_boys", 
  "indicator1_idps_girls", 
  "indicator1_refugees_total", 
  "indicator1_refugees_boys", 
  "indicator1_refugees_girls", 
  "indicator1_cwd_total", 
  "indicator1_cwd_boys", 
  "indicator1_cwd_girls", 
  "indicator1_narrative",
  "x1", 
  "indicator2_all_total", 
  "indicator2_all_boys", 
  "indicator2_all_girls",
  "indicator2_host_community_total", 
  "indicator2_host_community_boys", 
  "indicator2_host_community_girls",
  "indicator2_idps_total", 
  "indicator2_idps_boys", 
  "indicator2_idps_girls", 
  "indicator2_refugees_total", 
  "indicator2_refugees_boys", 
  "indicator2_refugees_girls", 
  "indicator2_cwd_total", 
  "indicator2_cwd_boys", 
  "indicator2_cwd_girls", 
  "indicator2_new_latrines", 
  "indicator2_rehabiltated_latrines", 
  "indicator2_new_classrooms", 
  "indicator2_rehabilitated_classrooms",
  "indicator2_narrative",
  "x2", 
  "indicator3_all_total", 
  "indicator3_all_boys", 
  "indicator3_all_girls",
  "indicator3_host_community_total", 
  "indicator3_host_community_boys", 
  "indicator3_host_community_girls",
  "indicator3_idps_total", 
  "indicator3_idps_boys", 
  "indicator3_idps_girls", 
  "indicator3_refugees_total", 
  "indicator3_refugees_boys", 
  "indicator3_refugees_girls", 
  "indicator3_cwd_total", 
  "indicator3_cwd_boys", 
  "indicator3_cwd_girls", 
  "indicator3_narrative",
  "x3", 
  "indicator4_all_total", 
  "indicator4_all_male", 
  "indicator4_all_female",
  "indicator4_host_community_total", 
  "indicator4_host_community_male", 
  "indicator4_host_community_female",
  "indicator4_idps_total", 
  "indicator4_idps_male", 
  "indicator4_idps_female", 
  "indicator4_refugees_total", 
  "indicator4_refugees_male", 
  "indicator4_refugees_female", 
  "indicator4_narrative",
  "x4",
  "indicator5_all_total", 
  "indicator5_all_male", 
  "indicator5_all_female",
  "indicator5_host_community_total", 
  "indicator5_host_community_male", 
  "indicator5_host_community_female",
  "indicator5_idps_total", 
  "indicator5_idps_male", 
  "indicator5_idps_female", 
  "indicator5_refugees_total", 
  "indicator5_refugees_male", 
  "indicator5_refugees_female", 
  "indicator5_narrative",
  "x5", 
  "indicator6_all_total", 
  "indicator6_all_male", 
  "indicator6_all_female", 
  "indicator6_narrative", 
  "x6", 
  "indicator7_all_total", 
  "indicator7_all_boys", 
  "indicator7_all_girls",
  "indicator7_host_community_total", 
  "indicator7_host_community_boys", 
  "indicator7_host_community_girls",
  "indicator7_idps_total", 
  "indicator7_idps_boys", 
  "indicator7_idps_girls", 
  "indicator7_refugees_total", 
  "indicator7_refugees_boys", 
  "indicator7_refugees_girls", 
  "indicator7_cwd_total", 
  "indicator7_cwd_boys", 
  "indicator7_cwd_girls", 
  "indicator7_narrative")


```

```{r}
counties <- locations %>% 
  distinct(adm1_en)
```



```{r}
unicef <- read_excel("./data/unicef_internal/Monthly Education SitRep_Jun23_mohamed.xlsx") %>% 
  setNames(messy) %>% 
  slice(10:284)

unicef %>% 
  mutate(county = ifelse(str_detect(month, "\\."), 
                         month, 
                         NA_character_), 
         county = gsub("[[:punct:]]|[[:digit:]]", "", county), 
         county = case_when(
           str_detect(county, "Garissa") ~ "Garissa", 
           str_detect(county, "Turkana") ~ "Turkana",
           str_detect(county, "Homa") ~ "Homa Bay", 
           TRUE ~ county)) %>% 
   fill(county) %>% 
  filter(month %in% c("Jan", "Feb", "Mar", "Apr", "May", "Jun")) %>% 
  count(county)
```


